<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-10">
        <h2>Patients</h2>
        <ol class="breadcrumb">
            <li>
                <a href="<%= root_path %>">Home</a>
            </li>
            <li class="active">
                <strong>Patients</strong>
            </li>
        </ol>
    </div>
    <div class="col-lg-2">
        <a href="<%= new_patient_path %>" class="btn btn-primary pull-right" style="margin: 30px 0 0 0;"><i class="fa fa-plus"></i> Add patient</a>
    </div>
</div>

<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>Editable Table in- combination with jEditable</h5>
                    <div class="ibox-tools">
                        <a class="collapse-link">
                            <i class="fa fa-chevron-up"></i>
                        </a>
                        <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                            <i class="fa fa-wrench"></i>
                        </a>
                        <ul class="dropdown-menu dropdown-user">
                            <li>
                                <a href="#">Config option 1</a>
                            </li>
                            <li>
                                <a href="#">Config option 2</a>
                            </li>
                        </ul>
                        <a class="close-link">
                            <i class="fa fa-times"></i>
                        </a>
                    </div>
                </div>
                <div class="ibox-content">

                <div class="">
                    </div>
                    <table class="table table-striped table-bordered table-hover " id="tbl-patient">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Birth Date</th>
                                <th>Age</th>
                                <th>Gender</th>
                                <th>Civil Status</th>
                                <th>Weight</th>
                                <th>Height</th>
                                <th>Address</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% @patients.each do |patient|  %>
                                <tr class="gradeX">
                                    <td><%= patient.last_name %>, <%= patient.first_name %> <%= patient.middle_name %></td>
                                    <td><%= format_date(patient.birth_date, "%Y %B %d") %></td>
                                    <td><%= patient.age %></td>
                                    <td><%= patient.gender.titlecase %></td>
                                    <td><%= patient.civil_status.titlecase %></td>
                                    <td><%= patient.weight %></td>
                                    <td><%= patient.height %></td>
                                    <td><%= patient.address %></td>
                                    <td class="center">
                                        <a href="<%= edit_patient_path(patient.id) %>" class="btn btn-primary btn-xs" ><i class="fa fa-pencil-square-o"></i></a>
                                        <a href="javascript:void(0);" class="btn btn-danger btn-xs" id="btn-delete"><i class="fa fa-trash"></i></a>
                                    </td>
                                </tr>
                            <% end %>
                        </tbody>
                        <tfoot>
                            <tr>
                                <th>Name</th>
                                <th>Birth Date</th>
                                <th>Age</th>
                                <th>Gender</th>
                                <th>Civil Status</th>
                                <th>Weight</th>
                                <th>Height</th>
                                <th>Address</th>
                                <th>Action</th>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<% content_for :javascript do %>

<script type="text/javascript">


window.onload = function () {

    
    var success = getUrlParameter('success');
    
    if (success == 1){
         toastr.options = {
            closeButton: true,
            progressBar: true,
            showMethod: 'slideDown',
            timeOut: 4000
        };
        toastr.success('successfully created.', 'Patient');
    } else if (success == 3) {
         toastr.options = {
            closeButton: true,
            progressBar: true,
            showMethod: 'slideDown',
            timeOut: 4000
        };
        toastr.success('successfully deleted.', 'Patient');
    }
    
}


$(function() {

    $(document).on('click', '#btn-delete', function(){
        var user = $( this ).data('user')
        $("#frm-delete").attr("action", "/settings/users/" + user.id);
        $('#spn-name').text(toTitleCase(user.first_name) + " " + toTitleCase(user.last_name));
        $('#mdl-delete').modal()
    });
    
    $('.dataTables-example').DataTable({
        dom: '<"html5buttons"B>lTfgitp',
        buttons: [
            { extend: 'copy'},
            {extend: 'csv'},
            {extend: 'excel', title: 'ExampleFile'},
            {extend: 'pdf', title: 'ExampleFile'},

            {extend: 'print',
                customize: function (win){
                    $(win.document.body).addClass('white-bg');
                    $(win.document.body).css('font-size', '10px');

                    $(win.document.body).find('table')
                            .addClass('compact')
                            .css('font-size', 'inherit');
                }
            }
        ]

    });

    /* Init DataTables */
    var oTable = $('#tbl-patient').dataTable();


});

    
var getUrlParameter = function getUrlParameter(sParam) {
    var sPageURL = decodeURIComponent(window.location.search.substring(1)),
        sURLVariables = sPageURL.split('&'),
        sParameterName,
        i;

    for (i = 0; i < sURLVariables.length; i++) {
        sParameterName = sURLVariables[i].split('=');

        if (sParameterName[0] === sParam) {
            return sParameterName[1] === undefined ? true : sParameterName[1];
        }
    }
};
    
function toTitleCase(str)
{
    return str.replace(/\w\S*/g, function(txt){return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();});
}

</script>

<% end %>