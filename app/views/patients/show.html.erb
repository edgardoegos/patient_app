<style>
  .input-group-btn-vertical .bootstrap-touchspin-down {
    margin: -7px 0 0 -1px !important;
  }

  .required {
    color: #ca4440;
  }

    .mp0i {
      margin: 0 !important;
      padding: 0 !important;
    }

  .inline-group label,
  inline-group p {
    display:inline;
  }


  .record-container {

    min-height: 230px;
  }

</style>
<div class="row wrapper border-bottom white-bg page-heading">
  <div class="col-lg-10">
    <h2>Edit Patient</h2>
    <ol class="breadcrumb">
      <li>
        <a href="<%= root_url %>">Home</a>
      </li>
      <li>
        <a href="<%= patients_path %>">Patients</a>
      </li>
      <li class="active">
        <strong>Patient Details</strong>
      </li>
    </ol>
  </div>
</div>

<div class="wrapper wrapper-content animated fadeInRight">
  <div class="row">
    <div class="col-lg-5">
      <div class="ibox float-e-margins">
        <div class="ibox-title">
          <h5>Personal Information: </h5>
        </div>
        <div class="ibox-content">
          <div class="row record-container">

            <div class="col-md-12">
              <div class="form-group">
                <div class="inline-group col-xs-8">
                  <label class="control-label">Patient: </label>
                  <p><%= "#{ @patient.last_name }, #{@patient.first_name } #{@patient.middle_name }" %></p>
                </div>
                <div class="inline-group col-xs-6">
                  <label class="control-label">Occupation: </label>
                  <p><%= @patient.occupation %></p>
                </div>
              </div>
            </div>

            <div class="col-md-12">
              <div class="form-group">
                <div class="inline-group col-xs-4">
                  <label class="control-label">Birthdate: </label>
                  <p><%= format_date(@patient.birth_date, "%d/%m/%Y") %></p>
                </div>
                <div class="inline-group col-xs-4">
                  <label class="control-label">Gender: </label>
                  <p><%= @patient.gender.titlecase %></p>
                </div>
                <div class="inline-group col-xs-4">
                  <label class="control-label">Civil Status: </label>
                  <p><%= @patient.civil_status.titlecase %></p>
                </div>
              </div>
            </div>

            <div class="col-md-12">
              <div class="form-group">
                <div class="inline-group col-xs-8">
                  <label class="control-label">Address: </label>
                  <p><%= @patient.address %></p>
                </div>
                <div class="inline-group col-xs-4">
                  <label class="control-label">Contact: </label>
                  <p><%= @patient.contact %></p>
                </div>
              </div>
            </div>

            <div class="col-md-12">
              <div class="form-group">
                <div class="inline-group col-xs-4">
                  <label class="control-label">Blood Type: </label>
                  <p><%= @patient.blood_type %></p>
                </div>
                <div class="inline-group col-xs-4">
                  <label class="control-label">Weight: </label>
                  <p><%= @patient.weight %></p>
                </div>
                <div class="inline-group col-xs-4">
                  <label class="control-label">Height: </label>
                  <p><%= @patient.height %></p>
                </div>
              </div>
            </div>

          </div>

          <div class="hr-line-dashed"></div>

        </div>
      </div>
    </div>

    <div class="col-lg-7">
      <div class="ibox float-e-margins">
        <div class="ibox-title">
          <h5>Medical Record: </h5>
        </div>
        <div class="ibox-content">
          <div class="row">
            <div class="col-md-12">
              <div class="row record-container">
                <div class="col-md-12">
                  <div class="form-group">
                    <div class="inline-group col-xs-6">
                      <label class="control-label">Health Care Provider: </label>
                      <p><%= @patient.hmo_id == 0 ? "None" : get_hmo_by_id(@patient.hmo_id) %></p>
                    </div>

                    <div class="inline-group col-xs-4">
                      <label class="control-label">Type: </label>
                      <p><%= @patient.medical_record["type"].titlecase %></p>
                    </div>

                  </div>
                </div>


                <div class="col-md-12">
                  <div class="form-group">

                    <div class="inline-group col-xs-6">
                      <label class="control-label">LMS: </label>
                      <p><%= @patient.medical_record["lmr"] %></p>
                    </div>

                    <div class="inline-group col-xs-4">
                      <label class="control-label">EDC: </label>
                      <p><%= @patient.medical_record["edc"] %></p>
                    </div>

                  </div>
                </div>

                <div class="col-md-12">
                  <div class="form-group">

                    <div class="inline-group col-xs-3">
                      <label class="control-label">Menarche: </label>
                      <p><%= @patient.medical_record["menarche"] %></p>
                    </div>

                    <div class="inline-group col-xs-2">
                      <label class="control-label">Gravida: </label>
                      <p><%= @patient.medical_record["gravida"] %></p>
                    </div>

                    <div class="inline-group col-xs-1">
                      <label class="control-label">Para: </label>
                      <p><%= @patient.medical_record["para"] %></p>
                    </div>

                    <div class="inline-group col-xs-1">
                      <label class="control-label">T: </label>
                      <p><%= @patient.medical_record["t"] %></p>
                    </div>

                    <div class="inline-group col-xs-1">
                      <label class="control-label">P: </label>
                      <p><%= @patient.medical_record["p"] %></p>
                    </div>

                    <div class="inline-group col-xs-1">
                      <label class="control-label">A: </label>
                      <p><%= @patient.medical_record["a"] %></p>
                    </div>

                    <div class="inline-group col-xs-1">
                      <label class="control-label">L: </label>
                      <p><%= @patient.medical_record["l"] %></p>
                    </div>

                  </div>
                </div>

                <div class="col-md-12">
                  <div class="forn-group">
                    <div class="inline-group col-xs-6">
                      <label class="control-label">Return Visit: </label>
                      <p><%= @patient.medical_record["return_visit"] %></p>
                    </div>
                  </div>
                  <div class="forn-group">
                    <div class="inline-group col-xs-6">
                      <label class="control-label">Record Date: </label>
                      <p><%= @patient.medical_record["record_date"] %></p>
                    </div>
                  </div>
                </div>

              </div>

              <div class="hr-line-dashed"></div>
            </div>
          </div>
        </div>
      </div>
    </div>



    <div class="col-lg-12">
      <div class="ibox float-e-margins">
        <div class="ibox-title">
          <h5>Medical Record Continuation: </h5>
        </div>
        <div class="ibox-content">
          <div class="row">
            <div class="col-md-12">

              <div class="well">
                <div class="row">

                <div class="col-md-6">
                  <div class="row">
                    <div class="col-md-12">
                      <div class="form-group">
                        <div class="inline-group col-xs-12">
                          <label class="control-label">Chief Complaint : </label>
                          <p><%= @patient.medical_record['chief_complaint'] %></p>
                        </div>
                      </div>
                    </div>
                    </div>
                  </div>

                <div class="col-md-6">
                  <div class="row">
                    <div class="col-md-12">
                      <div class="form-group">
                        <div class="inline-group col-xs-12">
                          <label class="control-label">History of Present Illness: </label>
                          <p><%= @patient.medical_record['history_of_present_illness'] %></p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="col-md-6">
                  <div class="row">
                    <div class="col-md-12">
                      <div class="form-group">
                        <div class="inline-group col-xs-12">
                          <label class="control-label">Ob-Gyne History: </label>
                          <p><%= @patient.medical_record['ob_history'] %></p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="col-md-6">
                  <div class="row">
                    <div class="col-md-12">
                      <div class="form-group">
                        <div class="inline-group col-xs-12">
                          <label class="control-label">Management: </label>
                          <p><%= @patient.medical_record['management'] %></p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="col-md-12">
                  <div class="row">
                    <div class="col-md-12">
                      <div class="form-group">
                        <div class="inline-group col-xs-12">
                          <label class="control-label">Recomendations: </label>
                          <p><%= @patient.medical_record['recommendations'] %></p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

              </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-lg-12">
      <div class="ibox float-e-margins">
        <div class="ibox-title">
          <h5>Attachments: </h5>
        </div>
        <div class="ibox-content">
          <div class="row">
            <div class="col-md-12">
              <div class="row">
                <div class="form-group">
                  <div class="col-md-4 col-xs-4">
                    <label class="control-label">PAST MEDICAL HISTORY</label>
                    <input id="past-medical-history" name="" type="file" multiple="" class="file-loading" data-type="medical-records" data-index="0">
                    <div id="medical-records-container" class="containers">

                    </div>
                  </div>
                  <div class="col-md-4 col-xs-4">
                    <label class="control-label">LABORATORY RESULTS</label>
                    <input id="laboratory-results" name="" type="file" multiple="" class="file-loading" data-type="laboratory-results" data-index="1">
                    <div id="laboratory-results-container" class="containers">

                    </div>
                  </div>
                  <div class="col-md-4 col-xs-4">
                    <label class="control-label">PHYSICAL EXAMINATIONS</label>
                    <input id="physical-examinations" name="" type="file" multiple="" class="file-loading" data-type="physical-examinations" data-index="2">
                    <div id="physical-examinations-container" class="containers">

                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>


    <div class="col-lg-12">
      <div class="ibox float-e-margins">
        <div class="ibox-title">
          <h5>Appointments: </h5>
        </div>
        <div class="ibox-content">
          <div class="row">
            <div class="col-md-12">
              <div class="well">
                <table class="table table-striped table-bordered table-hover " id="tbl-appointments">
                  <thead>
                  <tr>
                    <th>Complaint</th>
                    <th>Record Date</th>
                    <th>Type</th>
                  </tr>
                  </thead>
                  <tbody>
                  <% @appointments.each do |appointment|  %>
                      <tr class="gradeX">
                        <td class="ellipsis"><%= appointment.complaint %></td>
                        <td><%= format_date(appointment.consultation_date, "%Y %B %d") %></td>
                        <td><%= appointment.appointment_type.humanize.titlecase %></td>
                      </tr>
                  <% end %>
                  </tbody>
                  <tfoot>
                  <tr>
                    <th>Complaint</th>
                    <th>Record Date</th>
                    <th>Type</th>
                  </tr>
                  </tfoot>
                </table>

              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<% content_for :javascript do %>

    <script type="text/javascript">


      <%

         @past_medical_history_document_array = []
         @past_medical_history_document_file_name_array = []

         @laboratory_results_array = []
         @laboratory_results_document_file_name_array = []

         @physical_examination_array = []
         @physical_examination_document_file_name_array = []

       %>

      <% if !@attachments.nil? %>
      <% @attachments.each_with_index do |attachment, index| %>
      <% if attachment.attachment_type == 0 %>
      <% @past_medical_history_document_array.push(attachment.document.url(:original)) %>
      <% if attachment.document_content_type == "application/pdf" %>
      <% @past_medical_history_document_file_name_array.push({type: "pdf", id: attachment, caption: attachment.document_file_name, size: attachment.document_file_size, width: "120px", key: attachment.id, showDelete: false}) %>
      <% else %>
      <% @past_medical_history_document_file_name_array.push({caption: attachment.document_file_name, size: attachment.document_file_size, width: "120px", key: attachment.id, showDelete: false}) %>
      <% end %>
      <% elsif attachment.attachment_type == 1 %>
      <% @laboratory_results_array.push(attachment.document.url(:original)) %>
      <% if attachment.document_content_type == "application/pdf" %>
      <% @laboratory_results_document_file_name_array.push({type: "pdf", caption: attachment.document_file_name, size: attachment.document_file_size, width: "120px", key: attachment.id, showDelete: false}) %>
      <% else %>
      <% @laboratory_results_document_file_name_array.push({caption: attachment.document_file_name, size: attachment.document_file_size, width: "120px", key: attachment.id, showDelete: false}) %>
      <% end %>
      <% else %>
      <% @physical_examination_array.push(attachment.document.url(:original)) %>
      <% if attachment.document_content_type == "application/pdf" %>
      <% @physical_examination_document_file_name_array.push({type: "pdf", caption: attachment.document_file_name, size: attachment.document_file_size, width: "120px", key: attachment.id, showDelete: false}) %>
      <% else %>
      <% @physical_examination_document_file_name_array.push({caption: attachment.document_file_name, size: attachment.document_file_size, width: "120px", key: attachment.id, showDelete: false}) %>
      <% end %>
      <% end %>
      <% end %>
      <% end %>

      window.onload = function() {
        $('.file-caption-main').addClass('hidden')
      };

      $(function() {

        $('#tbl-appointments').dataTable();

        $("#past-medical-history").fileinput({
          initialPreview: <%= raw(@past_medical_history_document_array) %>,
          initialPreviewAsData: true,
          initialPreviewConfig: <%= raw(@past_medical_history_document_file_name_array.to_json) %>,
          overwriteInitial: false,
          showUpload: false,
          layoutTemplates: {
            main1: "{preview}\n" +
            "<div class=\'input-group {class}\'>\n" +
            "   <div class=\'input-group-btn\'>\n" +
            "       {browse}\n" +
            "       {upload}\n" +
            "       {remove}\n" +
            "   </div>\n" +
            "   {caption}\n" +
            "</div>"
          }
        });

        $("#laboratory-results").fileinput({
          initialPreview: <%= raw(@laboratory_results_array) %>,
          initialPreviewAsData: true,
          initialPreviewConfig: <%= raw(@laboratory_results_document_file_name_array.to_json) %>,
          overwriteInitial: false,
          showUpload: false,
          layoutTemplates: {
            main1: "{preview}\n" +
            "<div class=\'input-group {class}\'>\n" +
            "   <div class=\'input-group-btn\'>\n" +
            "       {browse}\n" +
            "       {upload}\n" +
            "       {remove}\n" +
            "   </div>\n" +
            "   {caption}\n" +
            "</div>"
          }
        });

        $("#physical-examinations").fileinput({
          initialPreview: <%= raw(@physical_examination_array) %>,
          initialPreviewAsData: true,
          initialPreviewConfig: <%= raw(@physical_examination_document_file_name_array.to_json) %>,
          overwriteInitial: false,
          showUpload: false,
          layoutTemplates: {
            main1: "{preview}\n" +
            "<div class=\'input-group {class}\'>\n" +
            "   <div class=\'input-group-btn\'>\n" +
            "       {browse}\n" +
            "       {upload}\n" +
            "       {remove}\n" +
            "   </div>\n" +
            "   {caption}\n" +
            "</div>"
          }
        });

        $('.i-checks').iCheck({
          checkboxClass: 'icheckbox_square-green',
          radioClass: 'iradio_square-green',
        });

      });

      var getUrlParameter = function getUrlParameter(sParam) {
        var sPageURL = decodeURIComponent(window.location.search.substring(1)),
            sURLVariables = sPageURL.split('&'),
            sParameterName,
            i;

        for (i = 0; i < sURLVariables.length; i++) {
          sParameterName = sURLVariables[i].split('=');

          if (sParameterName[0] === sParam) {
            return sParameterName[1] === undefined ? true : sParameterName[1];
          }
        }
      }




    </script>

<% end %>