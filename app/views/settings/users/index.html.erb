<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-10">
        <h2>User Management</h2>
        <ol class="breadcrumb">
            <li>
                <a href="<%= root_path %>">Home</a>
            </li>
            <li>
                <a>Settings</a>
            </li>
            <li class="active">
                <strong>User Management</strong>
            </li>
        </ol>
    </div>
    <div class="col-lg-2">
        <a href="<%= new_user_registration_path %>" class="btn btn-primary pull-right" style="margin: 30px 0 0 0;"><i class="fa fa-plus"></i> Add new user</a>
    </div>
</div>
<div class="wrapper wrapper-content animated fadeInRight">
<div class="row">
<div class="col-lg-12">
<div class="ibox float-e-margins">
<div class="ibox-title">
    <h5>Editable Table in- combination with jEditable</h5>
    <div class="ibox-tools">
        <a class="collapse-link">
            <i class="fa fa-chevron-up"></i>
        </a>
        <a class="dropdown-toggle" data-toggle="dropdown" href="#">
            <i class="fa fa-wrench"></i>
        </a>
        <ul class="dropdown-menu dropdown-user">
            <li>
                <a href="#">Config option 1</a>
            </li>
            <li>
                <a href="#">Config option 2</a>
            </li>
        </ul>
        <a class="close-link">
            <i class="fa fa-times"></i>
        </a>
    </div>
</div>
<div class="ibox-content">
    
<div class="">
    
</div>
<table class="table table-striped table-bordered table-hover " id="editable">
    <thead>
        <tr>
            <th>Username</th>
            <th>Email</th>
            <th>Name</th>
            <th>Status</th>
            <th>Role</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>
        <% @users.each do |user|  %>
            <tr class="gradeX">
                <td><%= user.username %></td>
                <td><%= user.email %></td>
                <td><%= user.first_name %> <%= user.last_name %></td>
                <td class="center"><%= user.status.titlecase %></td>
                <td class="center"><%= user.role.titlecase %></td>
                <td class="center">
                    <a href="<%= edit_settings_user_path(user.id) %>" class="btn btn-primary btn-xs" ><i class="fa fa-pencil-square-o"></i></a>
                    <a href="javascript:void(0);" class="btn btn-success btn-xs" ><i class="fa fa-sign-in"></i></a>
                    <a href="javascript:void(0);" class="btn btn-danger btn-xs" id="btn-delete" data-user="<%= user.to_json  %>"><i class="fa fa-trash"></i></a>
                </td>
            </tr>
        <% end %>
    </tbody>
    <tfoot>
        <tr>
            <th>Username</th>
            <th>Email</th>
            <th>Name</th>
            <th>Status</th>
            <th>Role</th>
            <th>Action</th>
        </tr>
    </tfoot>
</table>

</div>
</div>
</div>
</div>
</div>

<div id="mdl-delete" class="modal fade" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">Confirm Delete</h4>
      </div>
      <div class="modal-body">
          <p>Are you sure you want to delete <span id="spn-name">ascc</span>?</p>
      </div>
      <div class="modal-footer">
          <%= form_tag({}, {:method => :delete, :id => "frm-delete"}) do %>
              <button type="submit" class="btn btn-danger" >Delete</button>
              <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
          <% end %>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<% content_for :javascript do %>

<script type="text/javascript">

window.onload = function () {

    
    var success = getUrlParameter('success');
    
    if (success == 1){
         toastr.options = {
            closeButton: true,
            progressBar: true,
            showMethod: 'slideDown',
            timeOut: 4000
        };
        toastr.success('successfully created.', 'User');
    } else if (success == 3) {
         toastr.options = {
            closeButton: true,
            progressBar: true,
            showMethod: 'slideDown',
            timeOut: 4000
        };
        toastr.success('successfully deleted.', 'User');
    }
    
}


$(function() {

    $(document).on('click', '#btn-delete', function(){
        var user = $( this ).data('user')
        $("#frm-delete").attr("action", "/settings/users/" + user.id);
        $('#spn-name').text(toTitleCase(user.first_name) + " " + toTitleCase(user.last_name));
        $('#mdl-delete').modal()
    });
    
    $('.dataTables-example').DataTable({
        dom: '<"html5buttons"B>lTfgitp',
        buttons: [
            { extend: 'copy'},
            {extend: 'csv'},
            {extend: 'excel', title: 'ExampleFile'},
            {extend: 'pdf', title: 'ExampleFile'},

            {extend: 'print',
                customize: function (win){
                    $(win.document.body).addClass('white-bg');
                    $(win.document.body).css('font-size', '10px');

                    $(win.document.body).find('table')
                            .addClass('compact')
                            .css('font-size', 'inherit');
                }
            }
        ]

    });

    /* Init DataTables */
    var oTable = $('#editable').dataTable();


});

var getUrlParameter = function getUrlParameter(sParam) {
    var sPageURL = decodeURIComponent(window.location.search.substring(1)),
        sURLVariables = sPageURL.split('&'),
        sParameterName,
        i;

    for (i = 0; i < sURLVariables.length; i++) {
        sParameterName = sURLVariables[i].split('=');

        if (sParameterName[0] === sParam) {
            return sParameterName[1] === undefined ? true : sParameterName[1];
        }
    }
};
    
function fnClickAddRow() {
    $('#editable').dataTable().fnAddData( [
        "Custom row",
        "New row",
        "New row",
        "New row",
        "New row" ] );

}
    
function toTitleCase(str)
{
    return str.replace(/\w\S*/g, function(txt){return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();});
}

</script>

<% end %>
